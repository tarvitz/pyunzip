{% load kamwhfilters %} {% load newsfilters %}
{% block head_content %}
<link rel="stylesheet" type="text/css" href="/styles/{% if user.skin %}{{ user.skin.name|lower }}/{% endif %}message_class.css" media="screen">
<script language="javascript" type="text/javascript" src="/media/js/jquery.js"></script>
{% endblock %}

<script>
	$(document).ready(function(){
		//alert("O_O");
		var perform_update = function(field, val){
			var data = {};
			data[field] = val;
			var args = {type: "POST", url:"update/", data:data, complete:done};
			$.ajax(args);
		};

	});
	 function flip_to_textarea(id){
		var the_text = $("#text_"+id);
		var text_area = $('<textarea id="id_comment">'+the_text.text()+'</textarea><br>');
		the_text.replaceWith(text_area);
	}
</script>

<div align="center">
{% if comments.object_list %}{% endif %}
{% for c in comments.object_list %}
<div id="message">
    {% if not c.is_removed %}
    <div id="msg_headline">
		<div class="transparency" id="black"></div>
		{% ifequal c.user user %}
			<a href="/comment/edit/{{ c.id }}" id="msg_button">[править]</a>
		{% endifequal %}

		<span id="msg_comment_date">[{{ c.submit_date|date:"Y/M/d, H:m:s" }}]</span>
		<span id="msg_user_nickname">{% spaceless %}
		<span id="nickname">{{ c.user.nickname }}</span> комментирует:
		{% endspaceless %}
		</span>
	</div>
    <div id="msg_content">
		<div id="msg_avatar">{% spaceless %}
			{% get_user_ranks for c.user as ranks %}
			{% if ranks %}
			<span id="msg_ranks">статус:
			{% for r in ranks %}
				<a href="/ranks/{{ r.rank.codename }}">{{ r.rank.short_name|lower }}</a>{% if not forloop.last %},{% endif %}
			{% endfor %}
			</span>
			{% endif %}{% endspaceless %}
			<img src="{{ c.user.avatar.url }}">
			{% check_if_online c.user as is_online 15 %} {% if is_online %}[online]{% else %}[offline]{% endif %}
			{% if user.is_authenticated %}
			{% if c.user.jid %}<a href="xmpp:{{ c.user.jid }}">[jid]</a>{% endif %}
			{% if c.user.uin %}<a href="icq:{{ c.user.uin }}">[icq]</a>{% endif %}
			{% if c.user.email %}<a href="mailto:{{ c.user.email }}">[mail]</a>{% endif %}
			{% endif %}
		</div> <!-- avatar -->
		<div id="msg_text">
			<div class="transparency" id="txt"></div>
			<div id="text_{{c.id}}">{{ c.comment|striptags|spadvfilter|safe }}</div>
			{% if c.user.about %}
			<small>---<br>{{ c.user.about }}</small>
			{% endif %}
			<br clear="all">
		</div> <!-- text -->
    </div> <!-- content -->
    <br clear="all">
	{% if user.skin %}
    <div id="msg_footer">{% spaceless %}
        {% if perms.news.edit_comments or user.is_superuser %}
            <a href="/comment/edit/{{ c.id }}">[править]</a> | 
            <a href="#" onClick="flip_to_textarea({{ c.id }})">[править2]</a> | 
        {% endif %}
        {% ifequal user c.user %}
			{% if not c.is_removed %}
		        <a href="/comment/{{ c.id }}/delete">[скрыть]</a> |
			{% else %}
				<a href="/comment/{{ c.id }}/restore">[показать]</a>
			{% endif %}
            {% if perms.news.purge_comments or user.is_superuser %}
            <a href="/comment/{{ c.id }}/purge/approve">[уничтожить]</a>
            {% endif %}
        {% else %}
        {% if perms.news.del_restore_comments or user.is_superuser %}
			{% if not c.is_removed %}
				<a href="/comment/{{ c.id }}/delete">[скрыть]</a> |
			{% else %}
				<a href="/comment/{{ c.id }}/restore">[показать]</a> | 
			{% endif %}
        {% endif %}
        {% if perms.news.purge_comments or user.is_superuser %}
            <a href="/comment/{{ c.id }}/purge/approve">[уничтожить]</a>
        {% endif %}
        {% endifequal %}
	{% endspaceless %}
    </div> <!-- footer -->
	{% endif %} {# if user.skin #}
{% else %} {# it's deleted #}
    {% spaceless %}
	{% if user.skin %}
	<div id="msg_headline">
	{% else %}
	<div id="msg_headline" class='anonymous'>
	{% endif %}{% endspaceless %}
		<div class="transparency" id="black"></div>
		<span id="msg_user_nickname" class='deleted'><span id="nickname">Коментарий скрыт</span></span>
	</div> <!-- headline -->
    {% if user.skin %}
	<div id="msg_footer" class="deleted">
	{% spaceless %}
    {% if perms.news.edit_comments or user.is_superuser %}
            <a href="/comment/edit/{{ c.id }}">[править]</a> | 
    {% endif %}
    {% ifequal user c.user %}
			{% if not c.is_removed %}
				<a href="/comment/{{ c.id }}/delete">[скрыть]</a> | 
            {% else %}
				<a href="/comment/{{ c.id }}/restore">[показать]</a> | 
			{% endif %}
            {% if perms.news.purge_comments or user.is_superuser %}
            <a href="/comment/{{ c.id }}/purge/approve">[уничтожить]</a>
            {% endif %}
        {% else %}
        {% if perms.news.del_restore_comments or user.is_superuser %}
			{% if not c.is_removed %}
				<a href="/comment/{{ c.id }}/delete">[скрыть]</a> | 
			{% else %}
				<a href="/comment/{{ c.id }}/restore">[показать]</a> |
			{% endif %}
        {% endif %}
        {% if perms.news.purge_comments or user.is_superuser %}
            <a href="/comment/{{ c.id }}/purge/approve">[уничтожить]</a>
        {% endif %}
        {% endifequal %}
    {% endspaceless %}
	</div> <!-- footer -->
	{% endif %} {# not an registered user #}
{% endif %}
</div> <!-- message -->

<br clear="all">
{% endfor %}

</div> <!-- comment center -->
