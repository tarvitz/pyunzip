{% extends base_template %} {% load i18n %}
{% block content %}
  <ul class="breadcrumb">
    <li><a href="{% url "pybb:index" %}">{% trans "forum" %}</a></li>
    <li><a href="{% url "news:news" %}">{% trans "news" %}</a></li>
    {% if object %}
      <li><a href='{{ object.get_absolute_url }}'>{{ object.title|lower }}</a></li>
      <li class="active">{% trans "edit article" %}</li>
    {% else %}
      <li class="active">{% trans "create article" %}</li>
    {% endif %}
  </ul>

  {% if object %}
    <h3>{% trans "Edit article" %}</h3>
  {% else %}
    <h3>{% trans "Add article" %}</h3>
  {% endif %}

  <form id='id-form-add' method='POST' action='{{ request.path }}'
        class='form-horizontal col-lg-10'>
    {% csrf_token %} {% trans "Save" as save_i18n %}
    {% include "forms/bootstrap_horizontal.html" %}
    {% include "forms/submit.html" with save_text=save_i18n klass=user.get_color_theme %}
  </form>
{% endblock %}

{% block endjs %}
  <script type='text/javascript'>
    /* settings */
    var markItUpParsers = {
      'bb-code': '{% url "news:markup-preview" %}?markup=bb-code&template=article',
      'textile': '{% url "news:markup-preview" %}?markup=textile&template=article'
    };

    //myMarkupSettings['bb-code']['previewParserPath'] = markItUpParsers['bb-code'];
    myMarkupSettings['textile']['previewParserPath'] = markItUpParsers['textile'];

    var reloadMarkItUp = function(type){
      setMarkItUp(type);
      $('#id-form-add #id_syntax').val(type);

    };
    var loadMarkitUp = function(type){
      var mySettings = myMarkupSettings["{{ syntax|default:'textile'}}"];
      settings = {
        //'bb-code': myMarkupSettings['bb-code'],
        'textile': myMarkupSettings['textile']
      };
      if (type in settings){
        mySettings = settings[type];
      }
      $('#id_content').markItUp(mySettings);
      $('#id_head_content').markItUp(mySettings);
    };

    var setMarkItUp = function(type){
      $('#id_content').markItUp('remove');
      $('#id_head_content').markItUp('remove');
      loadMarkitUp(type);
    };
    $(document).ready(function(){
      loadMarkitUp();
    });
  </script>
{% endblock %}
