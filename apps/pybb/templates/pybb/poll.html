{% load i18n %}
{% with poll=topic.poll %}
  <div class='message round'>
    <div class='message-headline'>
        <div class='links'>
          {% if topic.owner == user or perms.pybb.change_poll %}
            <span><a href='{{ poll.get_update_url }}'>{% trans "edit" %}</a></span>
          {% endif %}
          {% if perms.pybb.change_poll %}
            <span><a href='{{ poll.get_delete_url }}'>{% trans "delete" %}</a></span>
          {% endif %}
        </div>
      {% trans "Poll" %}: {{ poll.title }}
    </div>
    <div class='message-body'>
      <div class='text'>
        <h3>{{ poll.title }}</h3>
        {% if user in poll.get_voted_users %}
          {% for item in poll.items.all %}
            <span class='text-{{ item.score|yesno:"default,black" }}'>{{ item.title }}</span>
            <div class="progress">
              <div class="progress-bar progress-bar-{{ user.get_forum_theme|default:"default" }}"
                   role="progressbar" aria-valuenow="60"
                   aria-valuemin="0" aria-valuemax="100" style="width: {{ item.score }}%;">
                <strong>{{ item.score }} % [{{ item.answers.count }}]</strong>
              </div>
            </div>
          {% endfor %}
        <em>{% trans "Users voted" %}: {{ poll.get_voted_users.count }}</em>
        {% else %}
          <form class='form-horizontal' action='{{ poll.get_vote_url }}' method='POST'>
            {% csrf_token %}
            {% include "forms/bootstrap_horizontal.html" with form=poll_form %}
            {% include "forms/submit.html" with klass=user.get_forum_theme|default:gs.FORUM_THEME_DEFAULT %}
          </form>
        {% endif %}
      </div>
    </div>
    <div class='message-footer'></div>
  </div>
{% endwith %}