{% load votetags %} {% load newsfilters %}
{% block css %}
{{ block.super }}
<link type='text/css' rel='stylesheet' href='/styles/{{ user.skin.name|getskincss:"message.css" }}'>
<link type='text/css' rel='stylesheet' href='/styles/{{ user.skin.name|getskincss:"replay.css" }}'>
{% endblock %}
<div align="center">
<div class='message'>
	<div class='msg_headline'>
		<div class='transparency' id='black'></div>
		<span class="msg_comment_date">[{{ r.upload_date|date:"Y/M/d H:m:s" }}]</span>
		<span class="msg_replay_name"><span class='replay_name'>
        {% if replays %} <a href="">{{ r.name }}</a>{% else %} {{ r.name }}{% endif %}</span></span>
	</div> {# headline #}
	<div class='msg_content'>
		<div class='transparency'></div>
		<div class='msg_avatar'>{% spaceless %}
			{% block msg_avatar %}
			{% endblock %}
		{% endspaceless %}
		</div>{# avatar #}
		<div class='msg_text'>
		<span class="msg_game_icon">
		<a href="">
		<img src='/media/images/replays/{{ r.version.game.short_name}}_{{ r.version.name|lower }}.png'>
		</a></span>
			<div class='msg_replay_info'>
				{% if r.is_set %}
				{# set it hide #}
				<div class='is_set'>{% spaceless %}
					<a href="javascript:show_hide('pack_{{ r.id }}')">Пак реплеев</a>
					<ul class='replay_pack' style="display:none;" id="pack_{{ r.id }}">
					{% for inf in r.zip_info.info %}
					 {% if inf.small_filename %}
						<li>
							{#<a href="{% url apps.files.views.return_replay_from_pack id=r.id idx=inf.idx %}"> #}
								{{ inf.small_filename }}{# </a> #}
							<span class="size_info">
								[rec: <a href="">
									{{ inf.file_size|filesizeformat }}</a>
								{# |zip: <a href=""> #}
								{# {{ inf.compress_size|filesizeformat }}</a> #}
								|bz2: ~<a href="">
								{{inf.compress_size|filesizeformat }}</a>]
								{% if inf.comment %}
								<br>
								{{ inf.comment }}
								{% endif %}
							</span>
						</li>
					 {% endif %}
					{% endfor %}
					</ul>
				{% endspaceless %}
				</div> {# version #}

				{% endif %}
				{# implement as external html template #}
				{% comment %}{% get_vote for r as vote %}
			    {% check_user_voted for r with user as voted %} {% endspaceless %}
				{% bind r as vote_object %}
				{% include "stars.html" %}	
				{%if vote %}
				<div class='vote'>
					<span class='title'>Рейтинг:</span> <span class='info'>{{ vote }} баллов из {{ vote.total_rating }}</span>
				</div>
				{% endif %}
				{% endcomment %}
				<div class='filetype'>
					<span class='title'>Тип файла:</span> <span class='info'>{{ r.replay_type }} </span>
				</div>

				<div class='version'>{% spaceless %}
					<span class="title">Версия игры</span>:<span class="info"> 
					<a href="">
					{{ r.version.game }}: {{ r.version.name }}</a>
					[<a href="">{{ r.version.patch }}</a>]
					</span>
				{% endspaceless %}
				</div> {# version #}
				<div class='type'>{% spaceless %}
				{% ifequal r.type "0" %}
					<span class="title">Тип игры</span>:<span class="info">
					<a href="">
					{{ r.nonstd_layout }}</a></span>
				{% else %}
					<span class="title">Тип игры</span>:<span class="info"> 
					<a href="">
					{{ r.get_type }}</a></span>
				{% endifequal %}
				{% endspaceless %}
				</div> {# type #}
				<div class='races'>{% spaceless %}
					<span class="title">Расы</span>:<span class="info"> {{ r.races }}</span>
				{% endspaceless %}
				</div> {# races #}
				{% if not r.is_set %}
				<div class='teams'>{% spaceless %}
					<span class="title">Игроки</span>:<span class="info"> {{ r.player_teams }}</span>
				{% endspaceless %}
				</div> {# teams #}
				<div class='winner'>{% spaceless %}
					<a href="javascript:show_hide('winners_{{ r.id }}')">Команда победитель</a>:
					<span style="display: none;" id="winners_{{ r.id }}">{{ r.winner_names }}</span>
				{% endspaceless %}
				</div>{# winners #}
				{% endif %}
				<div class='replay_link'>{% spaceless %}
					<a href="{{ r.replay.url }}">Реплей</a> [ {{ r.replay.size }} ]
				{% endspaceless %}
				</div>{# link #}
			</div> {# replay_info #}
			<hr width='35%'>
			<div class='comment'>
				{{ r.comments|striptags|spadvfilter|safe }}
			</div> {# comments #}
		<br clear='all'>
		</div> {# text #}
	</div> {# content #}
	<br clear='all'>
	<div class='msg_footer'>
		{% if replays %} {# actions if we're listing whole replays #}
        {% load comments %}
        {% get_comment_count for r as comment_counts %}
        <a href="">Комментариев: {{ comment_counts }}</a>
        {% else %}
        <a href="">[править]</a>
		| [скрыть] | 
		<a href="">[удалить]</a>
        {% endif %}
	</div> {# footer #}
</div> {# replay #}
</div> {# div center #}
